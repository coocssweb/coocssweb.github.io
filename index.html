<!DOCTYPE html>
<html lang="en">
<head>
    <title></title>
    <meta name="keyword" content="">
    <meta name="description" content="">
    <meta charset="UTF-8">
    <meta content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=0" name="viewport">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="format-detection" content="telephone=no">
	<link rel="manifest" href="/manifest.json">
    <script>
        ; (function (win, doc) {
            var docEl = doc.documentElement,
                UA = navigator.userAgent,
                isMeitu = /meitu|meipai/gi.test(UA);
            var refreshRem = function () {
                var w = docEl.getBoundingClientRect().width || 320;
                var fontSize = w / 320 * 20;
                fontSize = fontSize > 40 ? 40 : fontSize;
                docEl.style.fontSize = fontSize + 'px';
                var finalFontSize = parseFloat(win.getComputedStyle(docEl).getPropertyValue("font-size"));
                if (finalFontSize === fontSize || isMeitu) return;
                fontSize = fontSize + (fontSize - finalFontSize);
                docEl.style.fontSize = fontSize + 'px';
                win.fontSize = fontSize;
            }, refreshRemId;
            win.addEventListener('resize', function () {
                clearTimeout(refreshRemId);
                refreshRemId = setTimeout(refreshRem, 100);
            }, false);
            win.addEventListener('pageshow', function (e) {
                if (e.persisted) {
                    clearTimeout(refreshRemId);
                    refreshRemId = setTimeout(refreshRem, 100);
                }
            }, false);
            refreshRem();
        })(window, document);
    </script>
    <script type="text/javascript">
        let deferredPrompt = null;
        window.addEventListener('beforeinstallprompt', function(e){
            console.log('1.挂载事件', e);
            e.preventDefault();
            deferredPrompt = e;
        });


        window.addEventListener('appinstalled', (e) =>{
            deferredPrompt = null;
        });
    </script>
<link href="dist/stylesheets/index.91ffc5772a6f5c9f37c976962012762c.css" rel="stylesheet"></head>
<style type="text/css">
    .btn-install, .btn-open{
        position: absolute;
        bottom: 30px;
        width: 120px;
        left: 50%;
        margin-left: -60px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        background-color: #004d40;
        color: #fff;
        display: none;
        user-select: none;
    }

    .btn-open{
        background-color: #f29aaa;
    }

 
</style>
<body>
<div class="wrapper clearfix">
        <div class="home page">
    <div class="home-copy">
        <div class="home-content">
            <h2>写「漂亮的」代码</h2>
            <h3>It is a <mark>beautiful</mark> day, <mark>Don't</mark> let it get away</h3>
        </div>
    </div>
    <div class="btn-install">点击安装</div>
    <div class="btn-open">打开APP</div>
</div>
<div class="project">
    <h2><span>开源项目</span></h2>
    <div class="project-wrapper">
        <a class="project-item" href="https://github.com/coocssweb/react-ssr">
            <div class="project-name">React-SSR</div>
            <div class="project-desc">React服务端渲染</div>
        </a>
        <a class="project-item" href="https://coocssweb.github.io/react">
            <div class="project-name">React组件</div>
            <div class="project-desc">一些React组件</div>
        </a>
        <a class="project-item" href="https://coocssweb.github.io/animation">
            <div class="project-name">CssAnimation</div>
            <div class="project-desc">一些好玩的Css动画</div>
        </a>
        <a class="project-item" href="https://github.com/MeituPhone/h5-cli">
            <div class="project-name">H5Cli</div>
            <div class="project-desc">一个简洁的h5脚手架</div>
        </a>
        <a class="project-item" href="https://github.com/MeituPhone/coo-vue">
            <div class="project-name">CooVue</div>
            <div class="project-desc">一个响应式Vue组件库</div>
        </a>
    </div>
</div>
    

</div>

<script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
<script>
  var vConsole = new window.VConsole();
</script>

<script type="text/javascript" src="dist/js/index.5eef42b4.js"></script>
<script type="text/javascript">
    let $btnInstall = document.querySelector('.btn-install');
    let $btnOpen = document.querySelector('.btn-open');
    let isStandalone = false;
    try {
        isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
    } catch{}
    
    let _tick = null;
    const _checkInstall = async() => {
        try {
            console.log('1. 开始检查 getInstalledRelatedApps');
            const apps = await navigator.getInstalledRelatedApps();
            const isInstalled = (apps ||[]).find((item) => item.url=== 'https://coocssweb.github.io/manifest.json');
            console.log('2. 检查完成', apps, isInstalled);
    
            if (isInstalled) {
                $btnInstall.style.display = 'none';
                $btnOpen.style.display = 'flex';
                clearInterval(_tick);
            } else {
                $btnInstall.style.display = 'flex';
                $btnOpen.style.display = 'none';
            }
        }catch{}
    }

    $btnInstall.addEventListener('click', (e) =>{
        console.log('2. 点击开始安装');
        if (deferredPrompt?.prompt) {
            console.log('2.1 点击开始安装');
            deferredPrompt.prompt();

            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('2.2 点击了接受安装');
                    deferredPrompt = null;
                    $btnInstall.innerHTML = '正在安装中';
                    _tick = setInterval(() => {
                        _checkInstall();
                    }, 2000);
                } else {
                    
                }
            }).catch(error => {
                console.log('---------------', error);
            });
        }
    });

    (() => {
        if (isStandalone) {
            return;
        }
        console.log('5.初始化，发起安装状态检测');
        _checkInstall();
        setTimeout(() => {
            _checkInstall();
        }, 1000)
    })();

    $btnOpen.addEventListener('click', () => {
        console.log('6.点击了打开APP');
        window.open('https://coocssweb.github.io', '_blank');
    });
</script>
</body>
</html>
